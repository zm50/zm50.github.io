@[toc]

# 前言
你好，我是醉墨居士，因为Linux内核涉及的内容极多，我们初学者如果一上来就开始深挖细节，很有可能会在Linux内核代码的茫茫大海之中迷失自我。本篇博客希望可以帮助大家先有个全局的视野，剩余的细节内容，根据沿着全局的脉络去学习，可能会有意想不到的效果🫠

# 网络协议栈
#### 图解
![!\[在这里插入图片描述\](https://img-blog.csdnimg.cn/direct/00c1ab74129f491bb39a893c339fe2fc.png](https://i-blog.csdnimg.cn/blog_migrate/b9c67f3f8cadf6d52d2242e6c1fe21fc.png)
#### 功能
>应用层负责为上层应用程序提供用户接口
传输层负责端到端通信，数据的分割与重组，多路复用与解复用
网络层负责路由选择，数据的分组与重组，转发分组报文
链路层负责错误检测与纠正，帧同步，处理物理地址
物理层负责在网络中传输原始的比特流

# 发送Linux内核网络数据包
#### 图解
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/05a8bdb7ed01b8fd55ff01fcf02ee119.png)
#### 流程
>1.应用协议栈处理：对用户数据进行封装成应用数据
2.CPU Copy：CPU参与将用户空间的数据拷贝到内核的套接字缓冲区中
3.协议栈处理：将套接字缓冲区中的应用数据送给Linux内核网络协议栈进行封包后放入sk_buff
4.建立DMA映射：表示sk_buff中的数据已经装载完毕，设置sk_buff的地址和长度等
5.DMA Copy：通过DMA方式将sk_buff中的数据通过Rx Ring buffer拷贝到网卡的Rx FIFO
6.发送数据：通过有线或者无线的方式将数据发送到网络中

# 接收Linux内核网络数据包
#### 图解
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/3ea5138fa91a927bb0e66c3f8af9f771.png)

#### 流程
>1.接收数据：通过有线或者无线的方式接收网络中的数据
2.DMA Copy：通过DMA方式将网卡的Tx FIFO中的数据通过Tx Ring Buffer拷贝到sk_buff
3.硬件中断IRQ：跳转到对应IRQ的中断服务例程（ISR）来处理该事件
4.软中断：驱动程序通过软中断执行对应的软中断处理程序
5.协议栈处理：将sk_buff中的数据通过Linux内核网络协议栈进行拆包放入套接字缓冲区
6.CPU Copy：CPU参与将内核的套接字缓冲区拷贝到用户空间
7.应用协议栈处理：对应用数据解封装成用户数据

# 最后
我是醉墨居士，这篇博客我们大概梳理了一下Linux网络传输的总体流程😎
如果有问题可以及时通知我，私聊，评论都行哈🤗
